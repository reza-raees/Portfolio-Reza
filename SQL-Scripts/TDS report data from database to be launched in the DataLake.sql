WITH DOCPIVOT AS
(

    SELECT
        F.FORMULA_ID,
        F.FORMULA_CODE,
        F.VERSION,
        F.DESCRIPTION,
        F.STATUS_IND,
        F.C_BRAND,
        F.C_FLAVOUR,
        F.C_CATEGORY,
        F.C_FAMILY,
        F.C_SUBFAMILY,
        F.C_GAMMA,
		F.MODIFY_DATE,
        F.C_TDS_LANGUAGE,

        MAX(CASE WHEN D.FUNCTION_CODE = 'LEGAL NAME/DENOMINATION' THEN D.TEXT_DATA END) AS "LEGAL_NAME_DENOMINATION",
        MAX(CASE WHEN D.FUNCTION_CODE = 'SENSORY_DESCRIPTION' THEN D.TEXT_DATA END) AS "SENSORY_DESCRIPTION",
        MAX(CASE WHEN D.FUNCTION_CODE = 'INGREDIENT_DEC' THEN D.TEXT_DATA END) AS "INGREDIENT_DEC",
        MAX(CASE WHEN D.FUNCTION_CODE = 'USAGE_INSTRUCTIONS' THEN D.TEXT_DATA END) AS "USAGE_INSTRUCTIONS",
        MAX(CASE WHEN D.FUNCTION_CODE = 'MICROBIOLOGICAL_STANDARDS' THEN D.TEXT_DATA END) AS "MICROBIOLOGICAL_STANDARDS",
        MAX(CASE WHEN D.FUNCTION_CODE = 'TYPICAL_VALUES' THEN D.TEXT_DATA END) AS "TYPICAL_VALUES",
        MAX(CASE WHEN D.FUNCTION_CODE = 'PHYSICAL_DESCRIPTION' THEN D.TEXT_DATA END) AS "PHYSICAL_DESCRIPTION",
        MAX(CASE WHEN D.FUNCTION_CODE = 'STORAGE_HANDLING' THEN D.TEXT_DATA END) AS "STORAGE_HANDLING",
        MAX(CASE WHEN D.FUNCTION_CODE = 'GMTG7_INFO' THEN D.TEXT_DATA END) AS "GMTG7_INFO"

    FROM OPTIVA_FSFORMULA F
    LEFT JOIN OPTIVA_FSFORMULADOC D
        ON F.DOC_ID = D.DOC_ID
        AND D.FUNCTION_CODE IN (
            'LEGAL NAME/DENOMINATION',
            'SENSORY_DESCRIPTION',
            'INGREDIENT_DEC',
            'USAGE_INSTRUCTIONS',
            'MICROBIOLOGICAL_STANDARDS',
            'TYPICAL_VALUES',
            'PHYSICAL_DESCRIPTION',
            'STORAGE_HANDLING',
            'GMTG7_INFO'
        )

    WHERE F.FORMULA_CODE = '01010002-001' and F.VERSION = '002'
    GROUP BY
        F.FORMULA_ID,
        F.FORMULA_CODE,
        F.VERSION,
        F.DESCRIPTION,
        F.STATUS_IND,
        F.C_BRAND,
        F.C_FLAVOUR,
        F.C_CATEGORY,
        F.C_FAMILY,
        F.C_SUBFAMILY,
        F.C_GAMMA,
		F.MODIFY_DATE,
        F.C_TDS_LANGUAGE
),

PARAMAGG AS
(
    SELECT
        M.FORMULA_ID,


        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_TREENUTS' THEN M.PVALUE END) AS ALLERGEN_TREENUTS_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_TREENUTS' THEN M.ATTRIBUTE1 END) AS ALLERGEN_TREENUTS_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_PEANUTS' THEN M.PVALUE END) AS ALLERGEN_PEANUTS_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_PEANUTS' THEN M.ATTRIBUTE1 END) AS ALLERGEN_PEANUTS_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_SESAME' THEN M.PVALUE END) AS ALLERGEN_SESAME_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_SESAME' THEN M.ATTRIBUTE1 END) AS ALLERGEN_SESAME_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_WHEAT' THEN M.PVALUE END) AS ALLERGEN_WHEAT_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_WHEAT' THEN M.ATTRIBUTE1 END) AS ALLERGEN_WHEAT_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_CRUSTACEA' THEN M.PVALUE END) AS ALLERGEN_CRUSTACEA_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_CRUSTACEA' THEN M.ATTRIBUTE1 END) AS ALLERGEN_CRUSTACEA_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_EGG' THEN M.PVALUE END) AS ALLERGEN_EGG_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_EGG' THEN M.ATTRIBUTE1 END) AS ALLERGEN_EGG_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_FISH' THEN M.PVALUE END) AS ALLERGEN_FISH_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_FISH' THEN M.ATTRIBUTE1 END) AS ALLERGEN_FISH_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_SOY' THEN M.PVALUE END) AS ALLERGEN_SOY_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_SOY' THEN M.ATTRIBUTE1 END) AS ALLERGEN_SOY_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_MILK' THEN M.PVALUE END) AS ALLERGEN_MILK_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_MILK' THEN M.ATTRIBUTE1 END) AS ALLERGEN_MILK_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_CELERY' THEN M.PVALUE END) AS ALLERGEN_CELERY_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_CELERY' THEN M.ATTRIBUTE1 END) AS ALLERGEN_CELERY_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_MUSTARD' THEN M.PVALUE END) AS ALLERGEN_MUSTARD_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_MUSTARD' THEN M.ATTRIBUTE1 END) AS ALLERGEN_MUSTARD_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_MOLLUSCS' THEN M.PVALUE END) AS ALLERGEN_MOLLUSCS_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_MOLLUSCS' THEN M.ATTRIBUTE1 END) AS ALLERGEN_MOLLUSCS_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_SO2' THEN M.PVALUE END) AS ALLERGEN_SO2_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_SO2' THEN M.ATTRIBUTE1 END) AS ALLERGEN_SO2_SOURCE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_LUPIN' THEN M.PVALUE END) AS ALLERGEN_LUPIN_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ALLERGEN_LUPIN' THEN M.ATTRIBUTE1 END) AS ALLERGEN_LUPIN_SOURCE,

        -- CERTIFICATES / OTHER (PVALUE directly)
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_UTZ_HAZELNUTS' THEN M.PVALUE END) AS CERT_UTZ_HAZELNUTS_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_UTZ_HAZELNUTS' THEN M.ATTRIBUTE2 END) AS CERT_UTZ_HAZELNUTS_NOTES,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_UTZ_COCOA' THEN M.PVALUE END) AS CERT_UTZ_COCOA_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_UTZ_COCOA' THEN M.ATTRIBUTE2 END) AS CERT_UTZ_COCOA_NOTES,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_FT' THEN M.PVALUE END) AS CERT_FT_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_FT' THEN M.ATTRIBUTE2 END) AS CERT_FT_NOTES,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_RSPO' THEN M.PVALUE END) AS CERT_RSPO_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_RSPO' THEN M.ATTRIBUTE2 END) AS CERT_RSPO_NOTES,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_DOP' THEN M.PVALUE END) AS CERT_DOP_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_DOP' THEN M.ATTRIBUTE2 END) AS CERT_DOP_NOTES,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_IGP' THEN M.PVALUE END) AS CERT_IGP_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_IGP' THEN M.ATTRIBUTE2 END) AS CERT_IGP_NOTES,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_ALTROMERCATO' THEN M.PVALUE END) AS CERT_ALTROMERCATO_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CERT_ALTROMERCATO' THEN M.ATTRIBUTE2 END) AS CERT_ALTROMERCATO_NOTES,

        -- NUMBERED PARAMS
        MAX(CASE WHEN M.PARAM_CODE = '57_ORGANIC' THEN M.PVALUE END) AS "57_ORGANIC_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '57_ORGANIC' THEN M.ATTRIBUTE2 END) AS "57_ORGANIC_NOTES",
        MAX(CASE WHEN M.PARAM_CODE = '49_VEGETARIANS' THEN M.PVALUE END) AS "49_VEGETARIANS_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '50_VEGANS' THEN M.PVALUE END) AS "50_VEGANS_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '52_KOSHER_SUITABLE' THEN M.PVALUE END) AS "52_KOSHER_SUITABLE_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '52_KOSHER' THEN M.PVALUE END) AS "52_KOSHER_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '52_KOSHER' THEN M.ATTRIBUTE2 END) AS "52_KOSHER_NOTES",
        MAX(CASE WHEN M.PARAM_CODE = '51_HALAL_SUITABLE' THEN M.PVALUE END) AS "51_HALAL_SUITABLE_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '51_MUSLIM' THEN M.PVALUE END) AS "51_MUSLIM_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '51_MUSLIM' THEN M.ATTRIBUTE2 END) AS "51_MUSLIM_NOTES",
        MAX(CASE WHEN M.PARAM_CODE = '50_COELIACS' THEN M.PVALUE END) AS "50_COELIACS_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '50_COELIACS_20' THEN M.PVALUE END) AS "50_COELIACS_20_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'GMO_ROLLUP' THEN M.PVALUE END) AS "GMO_ROLLUP_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = '53_IRRADIATION' THEN M.PVALUE END) AS "53_IRRADIATION_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PACK_SIZE_NET' THEN M.PVALUE END) AS "PACK_SIZE_NET_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PACKS_PER_CASE' THEN M.PVALUE END) AS "PACKS_PER_CASE_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PALLET_NO' THEN M.PVALUE END) AS "PALLET_NO_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PACK_TYPE_INNER' THEN M.PVALUE END) AS "PACK_TYPE_INNER_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PACK_TYPE_OUTER_ID' THEN M.PVALUE END) AS "PACK_TYPE_OUTER_ID_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PACK_TYPE_OUTER' THEN M.PVALUE END) AS "PACK_TYPE_OUTER_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PALLET_TYPE_ID' THEN M.PVALUE END) AS "PALLET_TYPE_ID_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'PALLET_TYPE' THEN M.PVALUE END) AS "PALLET_TYPE_PVALUE",

        -- NUTRITION
        MAX(CASE WHEN M.PARAM_CODE = 'ENERGY_KJ_CALC' THEN M.PVALUE END) AS ENERGY_KJ_CALC_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'ENRGY_KCAL_CALC' THEN M.PVALUE END) AS ENRGY_KCAL_CALC_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'FAT' THEN M.PVALUE END) AS FAT_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'FASAT_G' THEN M.PVALUE END) AS FASAT_G_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'FAMS_G' THEN M.PVALUE END) AS FAMS_G_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'FAPU_G' THEN M.PVALUE END) AS FAPU_G_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CARBS_CALC' THEN M.PVALUE END) AS CARBS_CALC_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'CALC_AVAIL_CARB' THEN M.PVALUE END) AS CALC_AVAIL_CARB_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'SUGAR' THEN M.PVALUE END) AS SUGAR_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'STARCH' THEN M.PVALUE END) AS STARCH_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'POLYOLS' THEN M.PVALUE END) AS POLYOLS_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'SUGAR_ADD' THEN M.PVALUE END) AS SUGAR_ADD_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'FIBER' THEN M.PVALUE END) AS FIBER_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'PROTEIN' THEN M.PVALUE END) AS PROTEIN_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'SALT_EU_SODIUM_2.5' THEN M.PVALUE END) AS SALT_EU_SODIUM_2_5_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = '15_SODIUM_100' THEN M.PVALUE END) AS "15_SODIUM_100_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'MOISTURE' THEN M.PVALUE END) AS MOISTURE_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = '14_ASH' THEN M.PVALUE END) AS "14_ASH_PVALUE",
        MAX(CASE WHEN M.PARAM_CODE = 'ALCOHOL' THEN M.PVALUE END) AS ALCOHOL_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'SHELF_LIFE' THEN M.PVALUE END) AS SHELF_LIFE_PVALUE,
        MAX(CASE WHEN M.PARAM_CODE = 'FATRN_G' THEN M.PVALUE END) AS FATRN_G_PVALUE,
		
		-- NUTRITION UPDATED
		MAX(CASE WHEN M.PARAM_CODE = 'CHOLE_MG' THEN M.PVALUE END) AS CHOLE_MG_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'POTASSIUM' THEN M.PVALUE END) AS POTASSIUM_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CALCIUM' THEN M.PVALUE END) AS CALCIUM_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'IRON' THEN M.PVALUE END) AS IRON_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'SERV_PER_CONTAINER' THEN M.PVALUE END) AS SERV_PER_CONTAINER_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'ENRGY_KCAL_SV' THEN M.PVALUE END) AS ENRGY_KCAL_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FAT_SV' THEN M.PVALUE END) AS FAT_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FASAT_G_SV' THEN M.PVALUE END) AS FASAT_G_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FATRN_G_SV' THEN M.PVALUE END) AS FATRN_G_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CHOLE_MG_SV' THEN M.PVALUE END) AS CHOLE_MG_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'SODIUM_SV' THEN M.PVALUE END) AS SODIUM_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CARBS_SV' THEN M.PVALUE END) AS CARBS_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FIBER_SV' THEN M.PVALUE END) AS FIBER_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'SUGAR_SV' THEN M.PVALUE END) AS SUGAR_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'SUGAR_ADD_SV' THEN M.PVALUE END) AS SUGAR_ADD_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'PROTEIN_SV' THEN M.PVALUE END) AS PROTEIN_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'VIT_D_MCG_SV' THEN M.PVALUE END) AS VIT_D_MCG_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CALCIUM_SV' THEN M.PVALUE END) AS CALCIUM_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'IRON_SV' THEN M.PVALUE END) AS IRON_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'POTASSIUM_SV' THEN M.PVALUE END) AS POTASSIUM_SV_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FAT_DV_US' THEN M.PVALUE END) AS FAT_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FASAT_G_DV_US' THEN M.PVALUE END) AS FASAT_G_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CHOLE_MG_DV_US' THEN M.PVALUE END) AS CHOLE_MG_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'SODIUM_DV_US' THEN M.PVALUE END) AS SODIUM_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CARBS_DV_US' THEN M.PVALUE END) AS CARBS_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'FIBER_DV_US' THEN M.PVALUE END) AS FIBER_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'SUGAR_ADD_DV_US' THEN M.PVALUE END) AS SUGAR_ADD_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'PROTEIN_DV_US' THEN M.PVALUE END) AS PROTEIN_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'VIT_D_MCG_DV_US' THEN M.PVALUE END) AS VIT_D_MCG_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'CALCIUM_DV_US' THEN M.PVALUE END) AS CALCIUM_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'IRON_DV_US' THEN M.PVALUE END) AS IRON_DV_US_PVALUE,
		MAX(CASE WHEN M.PARAM_CODE = 'POTASSIUM_DV_US' THEN M.PVALUE END) AS POTASSIUM_DV_US_PVALUE

		
		

    FROM OPTIVA_FSFORMULATPALL M
    WHERE M.PARAM_CODE IN (
        'ALLERGEN_TREENUTS','ALLERGEN_PEANUTS','ALLERGEN_SESAME','ALLERGEN_WHEAT',
        'ALLERGEN_CRUSTACEA','ALLERGEN_EGG','ALLERGEN_FISH','ALLERGEN_SOY','ALLERGEN_MILK',
        'ALLERGEN_CELERY','ALLERGEN_MUSTARD','ALLERGEN_MOLLUSCS','ALLERGEN_SO2','ALLERGEN_LUPIN',
        'CERT_UTZ_HAZELNUTS','CERT_UTZ_COCOA','CERT_FT','CERT_RSPO','CERT_DOP','CERT_IGP','CERT_ALTROMERCATO',
        '57_ORGANIC','49_VEGETARIANS','50_VEGANS','52_KOSHER_SUITABLE','52_KOSHER','51_HALAL_SUITABLE',
        '51_MUSLIM','50_COELIACS','50_COELIACS_20',
        'ENERGY_KJ_CALC','ENRGY_KCAL_CALC','FAT','FASAT_G','FAMS_G','FAPU_G','CARBS_CALC','CALC_AVAIL_CARB',
        'SUGAR','STARCH','POLYOLS','SUGAR_ADD','FIBER','PROTEIN','SALT_EU_SODIUM_2.5','15_SODIUM_100','MOISTURE',
        '14_ASH','ALCOHOL','SHELF_LIFE','GMO_ROLLUP','53_IRRADIATION','PACK_SIZE_NET','PACKS_PER_CASE','PALLET_NO',
        'PACK_TYPE_INNER','PACK_TYPE_OUTER_ID','PACK_TYPE_OUTER','PALLET_TYPE_ID','PALLET_TYPE','CHOLE_MG',
		'POTASSIUM','CALCIUM','IRON','SERV_PER_CONTAINER','ENRGY_KCAL_SV','FAT_SV','FATRN_G','FASAT_G_SV','FATRN_G_SV','CHOLE_MG_SV',
		'SODIUM_SV','CARBS_SV','FIBER_SV','SUGAR_SV','SUGAR_ADD_SV','PROTEIN_SV','VIT_D_MCG_SV','CALCIUM_SV','IRON_SV',
		'POTASSIUM_SV','FAT_DV_US','FASAT_G_DV_US','CHOLE_MG_DV_US','SODIUM_DV_US','CARBS_DV_US','FIBER_DV_US',
		'SUGAR_ADD_DV_US','PROTEIN_DV_US','VIT_D_MCG_DV_US','CALCIUM_DV_US','IRON_DV_US','POTASSIUM_DV_US'

    )
    GROUP BY M.FORMULA_ID
)

SELECT
    D.FORMULA_CODE,
    D.DESCRIPTION,
    D.VERSION,
    D.STATUS_IND,
    D.C_BRAND,
    D.C_FLAVOUR,
    D.C_CATEGORY,
    D.C_FAMILY,
    D.C_SUBFAMILY,
    D.C_GAMMA,
	D.MODIFY_DATE,
    SETS.SET_CODE,
    D.C_TDS_LANGUAGE,
    D."LEGAL_NAME_DENOMINATION",
    D."SENSORY_DESCRIPTION",
    D."INGREDIENT_DEC",
    D."USAGE_INSTRUCTIONS",
    D."MICROBIOLOGICAL_STANDARDS",
    D."TYPICAL_VALUES",
    D."PHYSICAL_DESCRIPTION",
    D."STORAGE_HANDLING",
    D."GMTG7_INFO",

    -- ALLERGENS
    P.ALLERGEN_TREENUTS_PVALUE,
    P.ALLERGEN_TREENUTS_SOURCE,
    P.ALLERGEN_PEANUTS_PVALUE,
    P.ALLERGEN_PEANUTS_SOURCE,
    P.ALLERGEN_SESAME_PVALUE,
    P.ALLERGEN_SESAME_SOURCE,
    P.ALLERGEN_WHEAT_PVALUE,
    P.ALLERGEN_WHEAT_SOURCE,
    P.ALLERGEN_CRUSTACEA_PVALUE,
    P.ALLERGEN_CRUSTACEA_SOURCE,
    P.ALLERGEN_EGG_PVALUE,
    P.ALLERGEN_EGG_SOURCE,
    P.ALLERGEN_FISH_PVALUE,
    P.ALLERGEN_FISH_SOURCE,
    P.ALLERGEN_SOY_PVALUE,
    P.ALLERGEN_SOY_SOURCE,
    P.ALLERGEN_MILK_PVALUE,
    P.ALLERGEN_MILK_SOURCE,
    P.ALLERGEN_CELERY_PVALUE,
    P.ALLERGEN_CELERY_SOURCE,
    P.ALLERGEN_MUSTARD_PVALUE,
    P.ALLERGEN_MUSTARD_SOURCE,
    P.ALLERGEN_MOLLUSCS_PVALUE,
    P.ALLERGEN_MOLLUSCS_SOURCE,
    P.ALLERGEN_SO2_PVALUE,
    P.ALLERGEN_SO2_SOURCE,
    P.ALLERGEN_LUPIN_PVALUE,
    P.ALLERGEN_LUPIN_SOURCE,

    -- CERTIFICATES
    P.CERT_UTZ_HAZELNUTS_PVALUE,
    P.CERT_UTZ_HAZELNUTS_NOTES,
    P.CERT_UTZ_COCOA_PVALUE,
    P.CERT_UTZ_COCOA_NOTES,
    P.CERT_FT_PVALUE,
    P.CERT_FT_NOTES,
    P.CERT_RSPO_PVALUE,
    P.CERT_RSPO_NOTES,
    P.CERT_DOP_PVALUE,
    P.CERT_DOP_NOTES,
    P.CERT_IGP_PVALUE,
    P.CERT_IGP_NOTES,
    P.CERT_ALTROMERCATO_PVALUE,
    P.CERT_ALTROMERCATO_NOTES,

    -- PACKAGING / OTHER VALUES
    P.GMO_ROLLUP_PVALUE,
    P.PACK_SIZE_NET_PVALUE,
    P.PACKS_PER_CASE_PVALUE,
    P.PALLET_NO_PVALUE,
    P.PACK_TYPE_INNER_PVALUE,
    P.PACK_TYPE_OUTER_ID_PVALUE,
    P.PACK_TYPE_OUTER_PVALUE,
    P.PALLET_TYPE_ID_PVALUE,
    P.PALLET_TYPE_PVALUE,

    -- NUMBERED PARAMS
    P."57_ORGANIC_PVALUE",
    P."57_ORGANIC_NOTES",
    P."49_VEGETARIANS_PVALUE",
    P."50_VEGANS_PVALUE",
    P."52_KOSHER_SUITABLE_PVALUE",
    P."52_KOSHER_PVALUE",
    P."52_KOSHER_NOTES",
    P."51_HALAL_SUITABLE_PVALUE",
    P."51_MUSLIM_PVALUE",
    P."51_MUSLIM_NOTES",
    P."50_COELIACS_PVALUE",
    P."50_COELIACS_20_PVALUE",
    P."53_IRRADIATION_PVALUE",

    -- NUTRITION PVALUE COLUMNS
    P.ENERGY_KJ_CALC_PVALUE,
    P.ENRGY_KCAL_CALC_PVALUE,
    P.FAT_PVALUE,
    P.FASAT_G_PVALUE,
    P.FAMS_G_PVALUE,
    P.FAPU_G_PVALUE,
    P.CARBS_CALC_PVALUE,
    P.CALC_AVAIL_CARB_PVALUE,
    P.SUGAR_PVALUE,
    P.STARCH_PVALUE,
    P.POLYOLS_PVALUE,
    P.SUGAR_ADD_PVALUE,
    P.FIBER_PVALUE,
    P.PROTEIN_PVALUE,
    P.SALT_EU_SODIUM_2_5_PVALUE,
    P."15_SODIUM_100_PVALUE",
    P.MOISTURE_PVALUE,
    P."14_ASH_PVALUE",
    P.ALCOHOL_PVALUE,
    P.SHELF_LIFE_PVALUE,
    P.FATRN_G_PVALUE,
	
	--NUTRITION ADDED PVALUE
	P.CHOLE_MG_PVALUE,
	P.POTASSIUM_PVALUE,
	P.CALCIUM_PVALUE,
	P.IRON_PVALUE,
	P.SERV_PER_CONTAINER_PVALUE,
	P.ENRGY_KCAL_SV_PVALUE,
	P.FAT_SV_PVALUE,
	P.FASAT_G_SV_PVALUE,
	P.FATRN_G_SV_PVALUE,
	P.CHOLE_MG_SV_PVALUE,
	P.SODIUM_SV_PVALUE,
	P.CARBS_SV_PVALUE,
	P.FIBER_SV_PVALUE,
	P.SUGAR_SV_PVALUE,
	P.SUGAR_ADD_SV_PVALUE,
	P.PROTEIN_SV_PVALUE,
	P.VIT_D_MCG_SV_PVALUE,
	P.CALCIUM_SV_PVALUE,
	P.IRON_SV_PVALUE,
	P.POTASSIUM_SV_PVALUE,
	P.FAT_DV_US_PVALUE,
	P.FASAT_G_DV_US_PVALUE,
	P.CHOLE_MG_DV_US_PVALUE,
	P.SODIUM_DV_US_PVALUE,
	P.CARBS_DV_US_PVALUE,
	P.FIBER_DV_US_PVALUE,
	P.SUGAR_ADD_DV_US_PVALUE,
	P.PROTEIN_DV_US_PVALUE,
	P.VIT_D_MCG_DV_US_PVALUE,
	P.CALCIUM_DV_US_PVALUE,
	P.IRON_DV_US_PVALUE,
	P.POTASSIUM_DV_US_PVALUE

FROM DOCPIVOT D
LEFT JOIN PARAMAGG P ON D.FORMULA_ID = P.FORMULA_ID
INNER JOIN OPTIVA_FSFORMULAST SETS ON SETS.FORMULA_ID = P.FORMULA_ID
    AND SETS.SET_CODE IN ('GLOBAL','IS_EU','IRCA_SPA');